(function() {
  'use strict';
  var ContactForm = {
    init: function() {
      document.querySelectorAll('form.contact-form').forEach(function(form) {
        function hide(selector) {
          form.querySelectorAll(selector).forEach(function(element) {
            element.style.visibility = 'hidden';
          });
        }
        function show(selector) {
          form.querySelectorAll(selector).forEach(function(element) {
            element.style.visibility = 'visible';
          });
        }
        function clear(selector) {
          form.querySelectorAll(selector).forEach(function(element) {
            element.value = '';
          });
        }
        form.onsubmit = async function(e) {
          e.preventDefault();
          e.stopPropagation();
          hide('.error');
          hide('.success');
          var body = new FormData();
          body.append("subject", "Contact Form");
          body.append("from", e.target.from.value);
          body.append("name",  e.target.name.value);
          body.append("message", e.target.message.value);
          var response = await fetch(e.target.action, { method: e.target.method || 'POST', body });
          if (response.status >= 400) {
            console.error(await response.json());
            hide('.success');
            show('.error');
          } else {
            hide('.error');
            show('.success');
            window.setTimeout(function() {
              hide('.success, .error');
              clear('input, textarea');
            }, 5000);
          }
          return false;
        }; 
      });
    }
  };

  ContactForm.init();
  M.AutoInit();
})();