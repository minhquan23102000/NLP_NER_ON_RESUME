const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Certificates section', () => {
  it('is rendered if present', () => {
    const doc = createDocument({
      "certificates": [
        {
          "name": "Master Alchemist",
          "issuer": "Myself",
          "date": "1969-06-23"
        }
      ]
    });
    var header = doc.querySelector('#certificates h2');
    expect(header.textContent).toBe('Certificates');
    var certificates = doc.querySelectorAll('#certificates ul li');
    expect(certificates.length).toBe(1);
    expect(certificates[0].querySelector('h4').textContent).toBe('Master Alchemist');
    expect(certificates[0].querySelector('.caption').textContent).toContain('Myself');
    expect(certificates[0].querySelector('.caption').textContent).toContain('1969');
  });

  it('is not rendered if empty', () => {
    const doc = createDocument({
      "certificates": []
    });
    expect(doc.querySelector('#certificates')).toBeNull();
  });

  it('is not rendered if missing', () => {
    const doc = createDocument();
    expect(doc.querySelector('#certificates')).toBeNull();
  });

  describe('Header', () => {
    it('has default value', () => {
      const doc = createDocument({
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('#certificates h2').textContent).toBe(defaultHeaders.certificates);
    });

    it('supports custom value', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        },
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('#certificates h2').textContent).toBe('Certs');
    });

    it('is not rendered if custom value is set to false', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": false
          }
        },
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('#certificates h2')).toBeNull();
      expect(doc.querySelectorAll("#certificates ul li").length).toBe(1);
    });
    
    it('is not rendered if cerficiates section is empty', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        },
        "certificates": []
      });
      expect(doc.querySelector('#certificates h2')).toBeNull();
    });

    it('is not rendered if cerficiates section is missing', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        }
      });
      expect(doc.querySelector('#certificates h2')).toBeNull();
    });
  });

  describe('Footer link', () => {
    it('supports default header', () => {
      const doc = createDocument({
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('footer a[href="#certificates"]').textContent).toBe(defaultHeaders.certificates);
    });

    it('supports custom header', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        },
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('footer a[href="#certificates"]').textContent).toBe('Certs');
    });

    it('is not rendered if custom header is set to false', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": false
          }
        },
        "certificates": [
          {
            "name": "Master Alchemist",
            "issuer": "Myself",
            "date": "1969-06-23"
          }
        ]
      });
      expect(doc.querySelector('footer a[href="#certificates"]')).toBeNull();
    });

    it('is not rendered if cerficiates section is empty', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        },
        "certificates": []
      });
      expect(doc.querySelector('footer a[href="#certificates"]')).toBeNull();
    });

    it('is not rendered if cerficiates section is missing', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "certificates": "Certs"
          }
        }
      });
      expect(doc.querySelector('footer a[href="#certificates"]')).toBeNull();
    });
  });
});
