const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Contact Form', () => {
  it('is rendered with method="post" by default', () => {
    const doc = createDocument({
      "meta": {
        "contactForm": {
          "action": "http://localsmurf",
          "header": "Smurf me a line",
          "fields": [
            {
              "name": "subject"
            }
          ]
        }
      }
    });
    expect(doc.querySelector('form').method).toBe('post');
  });

  it('is not rendered if it has no action', () => {
    const doc = createDocument({
      "meta": {
        "contactForm": {
          "header": "Smurf me a line",
          "fields": [
            {
              "name": "subject"
            }
          ]
        }
      }
    });
    expect(doc.querySelector('form h4')).toBeNull();
  });

  it('is not rendered if it has no fields', () => {
    const doc = createDocument({
      "meta": {
        "contactForm": {
          "action": "http://localsmurf",
          "header": "Smurf me a line",
          "fields": []
        }
      }
    });
    expect(doc.querySelector('form h4')).toBeNull();
  });

  describe('Header', () => {
    it('has default value', () => {
      const doc = createDocument({
        "meta": {
          "contactForm": {
            "action": "http://localhost",
            "fields": [
              {
                "name": "subject"
              }
            ]
          }
        }
      });
      expect(doc.querySelector('form h4').textContent).toBe(defaultHeaders.contactForm);
    });

    it('supports custom value', () => {
      const doc = createDocument({
        "meta": {
          "contactForm": {
            "action": "http://localhost",
            "header": "Smurf me a line",
            "fields": [
              {
                "name": "subject"
              }
            ]
          }
        }
      });
      expect(doc.querySelector('form h4').textContent).toBe('Smurf me a line');
    });

    it('is not rendered if custom value is set to false', () => {
      const doc = createDocument({
        "meta": {
          "contactForm": {
            "action": "http://localhost",
            "header": false,
            "fields": [
              {
                "name": "subject"
              }
            ]
          }
        }
      });
      expect(doc.querySelector('form h4')).toBeNull();
    });
  });
});