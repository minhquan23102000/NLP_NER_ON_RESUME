
const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Summary section', () => {
    it('is rendered if present', () => {
        const document = createDocument({
            "basics": {
                "summary": "The only smurf with a beard and red clothes"
            }
        });
        expect(document.querySelector('#basics #summary h2 + div').textContent).toBe('The only smurf with a beard and red clothes');
    });

    it('is not rendered if missing', () => {
        const document = createDocument();
        expect(document.querySelector('#basics #summary')).toBeNull();
    });

    describe('Header', () => {
        it('supports default value', () => {
            const document = createDocument({
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('#basics #summary h2').textContent).toBe(defaultHeaders.basics);
        });

        it('supports custom value', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": "About me"
                    }
                },
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('#basics #summary h2').textContent).toBe('About me');
        });

        it('is not rendered if custom value is set to false', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": false
                    }
                },
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('#basics #summary h2')).toBeNull();
            expect(document.querySelector('#basics #summary div').textContent).toBe('The only smurf with a beard and red clothes');
        });

        it('is not rendered if basics section is missing', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": "About me"
                    }
                }
            });
            expect(document.querySelector('#basics #summary h2')).toBeNull();
        });
    });

    describe('Footer link', () => {
        it('supports default header', () => {
            const document = createDocument({
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('footer a[href="#basics"]').textContent).toBe(defaultHeaders.basics);
        });

        it('supports custom header', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": "About me"
                    }
                },
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('footer a[href="#basics"]').textContent).toBe('About me');
        });

        it('is not rendered if custom header is set to false', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": false
                    }
                },
                "basics": {
                    "summary": "The only smurf with a beard and red clothes"
                }
            });
            expect(document.querySelector('footer a[href="#basics"]')).toBeNull();
        });

        it('is not rendered if basics section is missing', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "basics": "About me"
                    }
                }
            });
            expect(document.querySelector('footer a[href="#basics"]')).toBeNull();
        });
    });
});
