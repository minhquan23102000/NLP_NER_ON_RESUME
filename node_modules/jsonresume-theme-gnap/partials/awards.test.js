const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Awards section', () => {
  it('is rendered if present', () => {
    const document = createDocument({
      "awards": [
        {
          "title": "Red Clothes",
          "awarder": "The Author",
          "summary": "For vigilant services",
          "date": "2021-06-23"
        }
      ]
    });
    expect(document.querySelector('#awards h2').textContent).toBe('Awards');
    const awards = document.querySelectorAll('#awards li');
    expect(awards.length).toBe(1);
    expect(awards[0].querySelector('h4').textContent).toBe('Red Clothes');
    expect(awards[0].querySelector('.caption').textContent).toContain('The Author');
    expect(awards[0].querySelector('.caption').textContent).toContain('2021');
    expect(awards[0].querySelector('.caption + div').textContent).toBe('For vigilant services');
  });

  it('is not rendered if missing', () => {
    const document = createDocument();
    expect(document.querySelector('#awards')).toBeNull();
  });

  it('is not rendered if empty', () => {
    const document = createDocument({
      "awards": []
    });
    expect(document.querySelector('#awards')).toBeNull();
  });

  describe('Header', () => {
    it('has default value', () => {
      const document = createDocument({
        "awards": [
          {
            "title": "Chief"
          }
        ]
      });
      expect(document.querySelector('#awards h2').textContent).toBe(defaultHeaders.awards);
    });

    it('supports custom value', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Medals"
          }
        },
        "awards": [
          {
            "title": "Chief"
          }
        ]
      });
      expect(document.querySelector('#awards h2').textContent).toBe('Medals');
    });

    it('is not rendered if custom value is set to false', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": false
          }
        },
        "awards": [
          {
            "title": "Chief"
          }
        ]
      });
      expect(document.querySelector('#awards h2')).toBeNull();
      expect(document.querySelectorAll('#awards li').length).toBe(1);
    });

    it('is not rendered if awards section is empty', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Awards"
          }
        },
        "awards": []
      });
      expect(document.querySelector('#awards h2')).toBeNull();
    });

    it('is not rendered if awards section is missing', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Awards"
          }
        }
      });
      expect(document.querySelector('#awards h2')).toBeNull();
    });
  });

  describe('Footer link', () => {
    it('supports default header', () => {
      const document = createDocument({
        "awards": [{
          "title": "Chief"
        }]
      });
      expect(document.querySelector("footer a[href='#awards']").textContent).toBe(defaultHeaders.awards);
    });

    it('supports custom header', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Custom Awards Header"
          }
        },
        "awards": [{
          "title": "Chief"
        }]
      });
      expect(document.querySelector("footer a[href='#awards']").textContent).toBe('Custom Awards Header');
    });

    it('is not rendered if custom header is set to false', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": false
          }
        },
        "awards": [{
          "title": "Chief"
        }]
      });
      expect(document.querySelector("footer a[href='#awards']")).toBeNull();
    });

    it('is not rendered if awards section is empty', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Medals"
          }
        },
        "awards": []
      });
      expect(document.querySelector('footer a[href="#awards"]')).toBeNull();
    });

    it('is not rendered if awards section is missing', () => {
      const document = createDocument({
        "meta": {
          "headers": {
            "awards": "Medals"
          }
        }
      });
      expect(document.querySelector('footer a[href="#awards"]')).toBeNull();
    });
  });
});