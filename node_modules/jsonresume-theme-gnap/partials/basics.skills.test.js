const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Skills section', () => {
    it('is displayed if present', () => {
        const document = createDocument({
            "skills": [
                {
                    "name": "Wizardry",
                    "level": "Master",
                    "keywords": [
                        "Spells"
                    ]
                }
            ]
        });

        const categories = document.querySelectorAll('#basics #skills .col');
        expect(categories.length).toBe(1);

        const category = categories[0];
        expect(category.querySelector('.caption').textContent).toBe('Wizardry');

        const skills = category.querySelectorAll('li');
        expect(skills.length).toBe(1);
        expect(skills[0].textContent).toBe('Spells');
    });

    it('is not displayed if empty', () => {
        const document = createDocument({
            "skills": []
        });
        expect(document.querySelector('#basics #skills')).toBeNull();
    });

    it('is not displayed if missing', () => {
        const document = createDocument();
        expect(document.querySelector('#basics #skills')).toBeNull();
    });

    describe('Header', () => {
        it('has default value', () => {
            const document = createDocument({
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('#basics #skills h2').textContent).toBe(defaultHeaders.skills);
        });

        it('supports custom value', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                },
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('#basics #skills h2').textContent).toBe('Abilities');
        });

        it('is not rendered if custom value is set to false', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": false
                    }
                },
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('#basics #skills h2')).toBeNull();
            expect(document.querySelectorAll('#basics #skills .col').length).toBe(1);
        });

        it('is not rendered if skills section is emtpy', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                },
                "skills": []
            });
            expect(document.querySelector('#basics #skills h2')).toBeNull();
        });

        it('is not rendered if skills section is missing', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                }
            });
            expect(document.querySelector('#basics #skills h2')).toBeNull();
        });
    });

    describe('Footer link', () => {
        it('supports default header', () => {
            const document = createDocument({
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('footer a[href="#skills"]').textContent).toBe(defaultHeaders.skills);
        });

        it('supports custom header', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                },
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('footer a[href="#skills"]').textContent).toBe('Abilities');
        });

        it('is not rendered if custom header is set to false', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": false
                    }
                },
                "skills": [
                    {
                        "name": "Wizardry",
                        "level": "Master",
                        "keywords": [
                            "Spells"
                        ]
                    }
                ]
            });
            expect(document.querySelector('footer a[href="#skills"]')).toBeNull();
        });        
        
        it('is not rendered if skills section is empty', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                },
                "skills": []
            });
            expect(document.querySelector('footer a[href="#skills"]')).toBeNull();
        });
        
        it('is not rendered if skills section is missing', () => {
            const document = createDocument({
                "meta": {
                    "headers": {
                        "skills": "Abilities"
                    }
                }
            });
            expect(document.querySelector('footer a[href="#skills"]')).toBeNull();
        });
    });
});
