const { createDocument } = require('../test-utils');
const { defaultHeaders } = require('../index');

describe('Work section', () => {
  it('is rendered if present', () => {
    const doc = createDocument({
      "work": [{
        "name": "Chief",
        "position": "Wizard",
        "location": "Smurf Village",
        "startDate": "1969-06-23",
        "endDate": "2469-06-23",
        "highlights": [
          "Saved the world"
        ]
      }]
    });
    const work = doc.querySelectorAll('#work > div > ul > li');
    expect(work.length).toBe(1);
    expect(work[0].querySelector('h4').textContent).toBe('Chief');
    expect(work[0].querySelector('.caption span').textContent).toBe('Wizard');
    expect(work[0].querySelectorAll('.caption time')[0].textContent).toContain('1969');
    expect(work[0].querySelectorAll('.caption time')[1].textContent).toContain('2469');
    const highlights = work[0].querySelectorAll('li');
    expect(highlights.length).toBe(1);
    expect(highlights[0].textContent).toBe('Saved the world');
  });

  it('is not rendered if empty', () => {
    const doc = createDocument({
      "work": []
    });
    expect(doc.querySelector('#work')).toBeNull();
  });

  it('is not rendered if missing', () => {
    const doc = createDocument();
    expect(doc.querySelector('#work')).toBeNull();
  });

  describe('Header', () => {
    it('has default value', () => {
      const doc = createDocument({
        "work": [{
          "name": "Chief",
          "position": "Wizard",
          "location": "Smurf Village",
          "startDate": "1969-06-23",
          "endDate": "2469-06-23",
          "highlights": [
            "Saved the world"
          ]
        }]
      });
      expect(doc.querySelector('#work h2').textContent).toBe(defaultHeaders.work);
    });

    it('supports custom value', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        },
        "work": [{ "name": "Chief" }]
      });
      expect(doc.querySelector('#work h2').textContent).toBe('Custom Work Header');
    });

    it('is not rendered if custom value is set to false', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": false
          }
        },
        "work": [{ "name": "Chief" }]
      });
      expect(doc.querySelector('#work h2')).toBeNull();
      expect(doc.querySelectorAll('#work > div > ul > li').length).toBe(1);
    });

    it('is not rendered if work section is empty', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        },
        "work": []
      });
      expect(doc.querySelector('#work h2')).toBeNull();
    });
    
    it('is not rendered if work section is missing', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        }
      });
      expect(doc.querySelector('#work h2')).toBeNull();
    });
  });

  describe('Footer link', () => {
    it('supports default header', () => {
      const doc = createDocument({
        "work": [{
          "name": "Chief",
          "position": "Wizard",
          "location": "Smurf Village",
          "startDate": "1969-06-23",
          "endDate": "2469-06-23",
          "highlights": [
            "Saved the world"
          ]
        }]
      });
      expect(doc.querySelector('footer a[href="#work"]').textContent).toBe(defaultHeaders.work);
    });

    it('supports custom header', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        },
        "work": [{ "name": "Chief" }]
      });
      expect(doc.querySelector('footer a[href="#work"]').textContent).toBe('Custom Work Header');
    });

    it('is not rendered if custom header is set to false', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": false
          }
        },
        "work": [{ "name": "Chief" }]
      });
      expect(doc.querySelector('footer a[href="#work"]')).toBeNull();
    });

    it('is not rendered if work section is empty', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        },
        "work": []
      });
      expect(doc.querySelector('footer a[href="#work"]')).toBeNull();
    });

    it('is not rendered if work section is missing', () => {
      const doc = createDocument({
        "meta": {
          "headers": {
            "work": "Custom Work Header"
          }
        }
      });
      expect(doc.querySelector('footer a[href="#work"]')).toBeNull();
    });
  });
});